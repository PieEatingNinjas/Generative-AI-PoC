using System.Collections.Generic;
using System.Net.Http;
using System.Text.Json;
using System.Threading.Tasks;

using Azure.AI.OpenAI;

using Domain;

using Microsoft.Azure.WebJobs;
using Microsoft.Azure.WebJobs.Extensions.DurableTask;
using Microsoft.Azure.WebJobs.Extensions.Http;

namespace GenerativeAi.Functions.question;

public class QuestionOrchestration
{
    private readonly OpenAIClient _openAiClient;

    public QuestionOrchestration(
                                 OpenAIClient openAiClient)
    {
        _openAiClient = openAiClient;
    }

    [FunctionName(nameof(Question))]
    public static async Task<HttpResponseMessage> Question([HttpTrigger(AuthorizationLevel.Anonymous, "post", Route = null)] HttpRequestMessage request,
                                                           [DurableClient] IDurableOrchestrationClient orchestrationClient)
    {
        var data = await request.Content.ReadAsAsync<QuestionRequest>();

        var instanceId = await orchestrationClient.StartNewAsync(nameof(QuestionOrchestrator), data);

        var result = await orchestrationClient.WaitForCompletionOrCreateCheckStatusResponseAsync(request, instanceId);
        return result;
    }

    [FunctionName(nameof(QuestionOrchestrator))]
    public async Task<QuestionResponse> QuestionOrchestrator([OrchestrationTrigger] IDurableOrchestrationContext context)
    {
        var request = context.GetInput<QuestionRequest>();

        //var embed = await _embed.Embedding(request.Question);
        //var results = await _documents.Search(embed);

        var doctorPrompt = new DoctorPrompt();


        //var data = "Teken zijn heel kleine spinachtige parasieten die leven in bossen, graslanden, struiken en duinen. Een teek heeft bloed nodig om zich voort te planten. Hij kan niet springen of vliegen, maar ‘wacht’ op planten of gras tot er een dier of mens voorbijkomt. \r\n\r\nDe teek laat zich dan vallen en hecht zich met de monddelen vast aan de huid van zijn slachtoffer. Hij zuigt zich gedurende meerdere uren tot dagen vol met bloed; een kleine huidwonde is het gevolg.\r\n\r\nEen tekenbeet op zich is niet gevaarlijk, maar de teek kan wel een rol spelen bij het overbrengen van verschillende ziektes (FSME of de ziekte van Lyme). \r\n\r\nDaarom moet je een teek zo snel mogelijk (binnen de 24 uur) verwijderen.\r\n\r\n# Dit doe je!\r\n## STAP 1\r\nWas of ontsmet je handen en trek wegwerphandschoenen aan.\r\n\r\n## STAP 2\r\nGa na wat er mis is.\r\n\r\n## STAP 3\r\nJe hoeft niet voor elke tekenbeet naar de arts. Als je de teek op een correcte manier hebt verwijderd en verder geen symptomen hebt, is er geen probleem.\r\n\r\nRaadpleeg gespecialiseerde hulp als:\r\n- er in de eerste weken na de beet een rode kring verschijnt. Die jeukt meestal niet, is niet pijnlijk, schilfert niet en is meestal niet gezwollen. Een dergelijke kring kan wijzen op de ziekte van Lyme en treedt op bij besmetting met de ziekte in 8 op de 10 gevallen. Hij groeit langzaam verder gedurende meerdere weken;\r\n- iemand in een gebied verbleef waar FSME voorkomt en daarvoor niet werd gevaccineerd;\r\n- bij andere ziektetekenen zoals koorts, onverklaarbare vermoeidheid of gewrichtspijn.\r\n\r\n## STAP 4\r\nVerleen verdere eerste hulp:\r\n- Verwijder de teek zo snel mogelijk. \r\n- Let erop dat de teek geen kans heeft om speeksel in de huid achter te laten. \r\n- Daarom neem je de teek best vast bij de monddelen en niet bij het lichaam. Bij druk op het lichaam kan de teek besmet speeksel en/of maaginhoud in de huid spuiten\r\n \r\n# Hulpmiddelen\r\n- Gebruik bij voorkeur een speciale tekenverwijderaar. Er bestaan verschillende modellen. Het koevoetmodel geeft de beste resultaten. Gebruik de tekenverwijderaar zoals omschreven in de gebruiksaanwijzing.\r\n- Gebruik liever geen pincet, aangezien de kans dan groot is dat je de teek plat knijpt. Alleen indien je geen tekenverwijderaar ter beschikking hebt, kan je de teek voorzichtig met een pincet verwijderen.\r\n\r\n# De teek verwijderen\r\n- Trek de teek recht uit de huid.\r\n- Verdoof de teek vóór je hem verwijdert niet met alcohol, ether of met een brandende sigaret.\r\n- Trek de teek geleidelijk, maar stevig uit de huid.\r\n- Probeer de teek in zijn geheel te verwijderen, maar het is niet erg als een stukje van de teek in de huid blijft vastzitten. De bacterie kan niet meer worden doorgegeven, maar wel een kleine huidinfectie veroorzaken.\r\n\r\n# Nazorg\r\n- Reinig de wonde uitgebreid met water en ontsmet nadien zorgvuldig met een waterig, niet-verkleurend ontsmettingsmiddel.\r\n- Noteer de datum van de beet en de plaats van de wonde. Observeer de plaats van de beet en noteer eventuele veranderingen van de huid. Het is belangrijk dat je veranderingen snel opmerkt.\r\n- Trek je wegwerphandschoenen uit en was of ontsmet je handen.\r\n\r\n\r\n\r\n# Wat stel je vast?\r\n- Je kan uit de omstandigheden afleiden dat het slachtoffer een giftig product heeft ingeslikt. Je ziet bijvoorbeeld een lege verpakking liggen of je ontdekt resten van een giftig product aan de mond van het slachtoffer. \r\n- Het slachtoffer geeft aan wat er is gebeurd.\r\n- Afhankelijk van het product kunnen de volgende symptomen onmiddellijk of na verloop van tijd optreden:\r\n    - braken of braakneigingen;\r\n    - buikkrampen;\r\n    - zeer grote of zeer kleine pupillen;\r\n    - brandwonden in de mond of keelholte;\r\n    - hoofdpijn en bewustzijnsstoornissen (duizeligheid, flauwte) of bewusteloosheid;\r\n    - ademhalingsmoeilijkheden: te snel (hyperventilatie), te traag, ondiep, belemmerd tot zelfs ademhalingsstilstand;\r\n    - problemen met de circulatie (bijvoorbeeld hartritmestoornissen) tot zelfs circulatiestilstand;\r\n    - afwijkende huidskleur (bleek, rood, blauw);\r\n    - klamme huid, sterk zweten;\r\n    - verhoogde lichaamstemperatuur;\r\n    - ongecontroleerde spiersamentrekkingen;\r\n    - tekenen van shock.\r\n\t\r\n## Let op\r\nHet slachtoffer kan onderkoeld raken. Als de werking van de hersenen onderdrukt is, kunnen de warmteregeling van het lichaam en de bewuste reacties van een persoon op een koude omgeving in het gedrang komen.\r\n\r\n# Dit doe je!\r\n## Let op: \r\nAlleen in het geval van een vergiftiging met een gekend huis-, tuin- en keukenproduct handel je zoals hier beschreven. Als het om een onbekend product gaat, alarmeer je best de Noodcentrale 112.\r\n## STAP 1\r\n- Verlucht het lokaal en sluit de verpakking af. Sommige producten kunnen namelijk schadelijke dampen afgeven.\r\n- Was of ontsmet je handen en trek handschoenen aan die bestand zijn tegen het giftige product als je in contact komt met kleding of lichaamsdelen waarop het product zich bevindt. Doe dat ook wanneer je de resten van de giftige stof verwijdert.\r\n- Verplaats resten van het product naar een veilige plaats als dat op een veilige manier lukt. Zo niet, laat die taak over aan een gespecialiseerde hulpverlener en overweeg het slachtoffer te verplaatsen.\r\n## STAP 2\r\n- Ga na wat er mis is.\r\n- Controleer het bewustzijn.\r\n- Open de luchtweg en controleer de ademhaling indien nodig.\r\n## STAP 3\r\nBij een vermoedelijke vergiftiging is het steeds aangeraden om gespecialiseerde hulp in te schakelen:\r\n- Alarmeer de Noodcentrale 112 als er ernstige symptomen zijn (bijvoorbeeld bewusteloosheid of ademhalingsmoeilijkheden) of als de toestand van het slachtoffer achteruitgaat.\r\n- In een minder ernstige situatie contacteer je het Antigifcentrum via het gratis telefoonnummer (+32) 70 245 245. De arts of apotheker kan je vertellen welke eerste hulp gepast is en of het raadzaam is een bezoek te brengen aan een arts. Wacht niet tot er symptomen verschijnen. Probeer de verpakking van het product bij de hand te hebben als je belt.\r\n## STAP 4\r\nVerleen verdere eerste hulp\r\n- Is het slachtoffer bewusteloos en ademt hij normaal? Leg hem in stabiele zijligging, bij voorkeur op zijn linkerzijde.\r\n- Volg het advies van de Noodcentrale 112 of het Antigifcentrum strikt op.\r\n- Trek je handschoenen uit en was of ontsmet je handen nadat je eerste hulp verleend hebt.\r\n";

        //var data = "{\r\n  \"id\": \"4vc924fvzctzk72vh1as69j8xx\",\r\n  \"title\": \"Blijf rustig \",\r\n  \"keywords\": \"noodsituatie, crisis, principe, eerste hulp, richtlijnen, basis, hulp verlenen, hulpverlener, helpen, rustig, besmetting, vermijden, emoties, comfort, slachtoffer, psychosociale hulp, reactie\",\r\n  \"rows\": [\r\n    {\r\n      \"text\": \"# Waarom?\\r\\nNoodsituaties komen plots en onverwacht, en leiden tot stress bij alle betrokkenen. Als je hulp biedt, probeer dan rust uit te stralen. Het zal ook het slachtoffer helpen om rustiger te worden. \",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"assetPath\": \"https://testehboweb.blob.core.windows.net/default-media/media/1 Principes van eerste hulp/1_Principesvaneerstehulp_01a.gif\",\r\n      \"type\": \"MediaRow\"\r\n    },\r\n    {\r\n      \"text\": \"# Wat doe je?\\r\\n- Adem een aantal keer diep in en uit.\\r\\n- Spreek jezelf vertrouwen in en zet negatieve gedachten opzij. \\r\\n- Praat met het slachtoffer.\\r\\n- Handel niet voor je rustig bent. \\r\\n- Gebruik alleen technieken die je leerde.\\r\\n\\r\\n# Meer hulp nodig?\\r\\nContacteer de Noodcentrale 112, de operator zal je helpen om gepaste hulp te bieden.\",\r\n      \"type\": \"TextRow\"\r\n    }\r\n  ],\r\n  \"contentType\": 1\r\n}{\r\n  \"id\": \"4qz1hars7xnvpz3nag6qy6eawg\",\r\n  \"title\": \"Principes van Eerste Hulp\",\r\n  \"keywords\": \"noodsituatie, crisis, principe, eerste hulp, richtlijnen, basis, hulp verlenen, hulpverlener, helpen, rustig, besmetting, vermijden, emoties, comfort, slachtoffer, psychosociale hulp, reactie\",\r\n  \"rows\": [\r\n    {\r\n      \"text\": \"Wanneer je eerste hulp verleent, is veiligheid de topprioriteit, maar er zijn er ook andere zaken waarmee je rekening moet houden.\\r\\n\\r\\nDit zijn de **basisprincipes** die essentieel zijn om op een goede manier eerste hulp te verlenen:\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"text\": \" Blijf rustig in een noodsituatie\",\r\n      \"id\": \"4hkfmqaa8j78rz98kbrk6q1z4p\",\r\n      \"openInInfoFlyout\": false,\r\n      \"type\": \"ThemeRow\"\r\n    },\r\n    {\r\n      \"text\": \" Vermijd besmetting\",\r\n      \"id\": \"432sm47x793bz2rgtjhk4275wh\",\r\n      \"openInInfoFlyout\": false,\r\n      \"type\": \"ThemeRow\"\r\n    },\r\n    {\r\n      \"text\": \" Handel als eerstehulpverlener\",\r\n      \"id\": \"42923geyp84wrxt0zrbm9efsnd\",\r\n      \"openInInfoFlyout\": false,\r\n      \"type\": \"ThemeRow\"\r\n    },\r\n    {\r\n      \"text\": \" Zorg voor het comfort van het slachtoffer\",\r\n      \"id\": \"4w631pnrr3q190b23a7qr6jpde\",\r\n      \"openInInfoFlyout\": false,\r\n      \"type\": \"ThemeRow\"\r\n    },\r\n    {\r\n      \"text\": \" Verleen psychosociale eerste hulp\",\r\n      \"id\": \"45h6n71z72g0e76e425tzmzxwp\",\r\n      \"openInInfoFlyout\": false,\r\n      \"type\": \"ThemeRow\"\r\n    },\r\n    {\r\n      \"text\": \" Hou rekening met emotionele reacties nadien\",\r\n      \"id\": \"40z97fgxkg5107ha7yx01t80cv\",\r\n      \"openInInfoFlyout\": false,\r\n      \"type\": \"ThemeRow\"\r\n    }\r\n  ],\r\n  \"contentType\": 1\r\n}";

        // var data = "{\r\n    \"ContentItemId\": \"4a8m3d9j5efm84ehe9ybrxr0n0\",\r\n    \"ContentItemVersionId\": \"4v8kspyzy8s03505yyqajwd6da\",\r\n    \"ContentType\": \"Apppageitem\",\r\n    \"DisplayText\": \" 6.1.2.4 Snijwonde - Dit doe je!\",\r\n    \"Latest\": true,\r\n    \"Published\": true,\r\n    \"ModifiedUtc\": \"2022-12-29T14:31:50.6005831Z\",\r\n    \"PublishedUtc\": \"2022-12-29T14:31:50.8338481Z\",\r\n    \"CreatedUtc\": \"2022-12-13T12:03:19.4902222Z\",\r\n    \"Owner\": \"4s0bxja3xtfbztbvjd4taybbwf\",\r\n    \"Author\": \"Raphael.Coudoux\",\r\n    \"Apppageitem\": {\r\n        \"ItemTitle\": {\r\n            \"Text\": \"6.1.2.4 Snijwonde - Dit doe je!\"\r\n        },\r\n        \"ContentTypeForApp\": {\r\n            \"Text\": \"article\"\r\n        },\r\n        \"ApppageItemContext\": {\r\n            \"TaxonomyContentItemId\": \"42xtncn8snb5dt33s7s1jvvpxy\",\r\n            \"TermContentItemIds\": [\r\n                \"4ex74mrfy9bp55jzwr9fcwctm1\",\r\n                \"4f38a8m8cgm91yy5fjvm0dnbc1\"\r\n            ]\r\n        },\r\n        \"Themes\": {\r\n            \"TaxonomyContentItemId\": \"49negjst84qhg2y4vg298q5pm0\",\r\n            \"TermContentItemIds\": [\r\n                \"4ecyda72cc1sqx6esb9awqbf5h\"\r\n            ]\r\n        },\r\n        \"Weight\": {\r\n            \"Value\": 5.0\r\n        },\r\n        \"ApppageItemKeywords\": {\r\n            \"Text\": null\r\n        },\r\n        \"DisplayTitle\": {\r\n            \"Text\": \"Dit doe je!\"\r\n        }\r\n    },\r\n    \"TitlePart\": {\r\n        \"Title\": \" 6.1.2.4 Snijwonde - Dit doe je!\"\r\n    },\r\n    \"FlowPart\": {\r\n        \"Widgets\": [\r\n            {\r\n                \"ContentItemId\": \"44qtr02xszbgg3232qzq0x2kd9\",\r\n                \"ContentItemVersionId\": null,\r\n                \"ContentType\": \"ContentBlock\",\r\n                \"DisplayText\": \"\",\r\n                \"Latest\": false,\r\n                \"Published\": false,\r\n                \"ModifiedUtc\": \"2022-12-29T14:31:50.6942546Z\",\r\n                \"PublishedUtc\": null,\r\n                \"CreatedUtc\": null,\r\n                \"Owner\": \"\",\r\n                \"Author\": \"Raphael.Coudoux\",\r\n                \"ContentBlock\": {\r\n                    \"ContentBlockTextField\": {\r\n                        \"Text\": \"- Dep de omgeving van de wonde droog, bijvoorbeeld met een zuivere\\r\\nhanddoek, zonder de wonde aan te raken.\\r\\n- Bedek de wonde na het reinigen, bijvoorbeeld met een steriel kompres (eventueel met hydrogel), een vetverband, een wondpleister of een tweedehuidverband.\\r\\n- Trek je wegwerphandschoenen uit en was of ontsmet je handen.\\r\\n\"\r\n                    }\r\n                },\r\n                \"FlowMetadata\": {\r\n                    \"Alignment\": 3,\r\n                    \"Size\": 100\r\n                }\r\n            },\r\n            {\r\n                \"ContentItemId\": \"4kay5e743ynz3xhnqmjx8v89d9\",\r\n                \"ContentItemVersionId\": null,\r\n                \"ContentType\": \"ContentBlock\",\r\n                \"DisplayText\": \"\",\r\n                \"Latest\": false,\r\n                \"Published\": false,\r\n                \"ModifiedUtc\": \"2022-12-29T14:31:50.705748Z\",\r\n                \"PublishedUtc\": null,\r\n                \"CreatedUtc\": null,\r\n                \"Owner\": \"\",\r\n                \"Author\": \"Raphael.Coudoux\",\r\n                \"ContentBlock\": {\r\n                    \"ContentBlockTextField\": {\r\n                        \"Text\": \"## Let op\\r\\n- Een arts kan ervoor kiezen om een wonde te hechten.\\r\\n- Gebruik zelf nooit hechtingsstrips.\\r\\n- Verwijder hechtingsdraden of nietjes niet zelf, maar laat dat over aan een verpleegkundige of arts.\\r\\n\"\r\n                    }\r\n                },\r\n                \"FlowMetadata\": {\r\n                    \"Alignment\": 3,\r\n                    \"Size\": 100\r\n                }\r\n            },\r\n            {\r\n                \"ContentItemId\": \"4dnf1pn07wxwe29m69t44jn1m9\",\r\n                \"ContentItemVersionId\": null,\r\n                \"ContentType\": \"LMSModuleBlock\",\r\n                \"DisplayText\": \"\",\r\n                \"Latest\": false,\r\n                \"Published\": false,\r\n                \"ModifiedUtc\": \"2022-12-29T14:31:50.7225795Z\",\r\n                \"PublishedUtc\": null,\r\n                \"CreatedUtc\": null,\r\n                \"Owner\": \"\",\r\n                \"Author\": \"Raphael.Coudoux\",\r\n                \"LMSModuleBlock\": {\r\n                    \"LMSModuleBlockMediaField\": {\r\n                        \"Paths\": [\r\n                            \"LMS/16 Snijwonden.lms\"\r\n                        ],\r\n                        \"MediaTexts\": [\r\n                            \"\"\r\n                        ]\r\n                    },\r\n                    \"DisplayTitle\": {\r\n                        \"Text\": \"Test je kennis\"\r\n                    }\r\n                },\r\n                \"FlowMetadata\": {\r\n                    \"Alignment\": 3,\r\n                    \"Size\": 100\r\n                }\r\n            }\r\n        ]\r\n    },\r\n    \"PreviewPart\": {},\r\n    \"LocalizationPart\": {\r\n        \"LocalizationSet\": \"4gc7vrz961q96r3n1qz0swxqd2\",\r\n        \"Culture\": \"nl-BE\"\r\n    }\r\n}";

        //  var data = "{\r\n  \"id\": \"4a8m3d9j5efm84ehe9ybrxr0n0\",\r\n  \"title\": \"Dit doe je!\",\r\n  \"keywords\": \"\",\r\n  \"rows\": [\r\n    {\r\n      \"text\": \"- Dep de omgeving van de wonde droog, bijvoorbeeld met een zuivere\\r\\nhanddoek, zonder de wonde aan te raken.\\r\\n- Bedek de wonde na het reinigen, bijvoorbeeld met een steriel kompres (eventueel met hydrogel), een vetverband, een wondpleister of een tweedehuidverband.\\r\\n- Trek je wegwerphandschoenen uit en was of ontsmet je handen.\\r\\n\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"text\": \"## Let op\\r\\n- Een arts kan ervoor kiezen om een wonde te hechten.\\r\\n- Gebruik zelf nooit hechtingsstrips.\\r\\n- Verwijder hechtingsdraden of nietjes niet zelf, maar laat dat over aan een verpleegkundige of arts.\\r\\n\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"metadataPath\": \"https://testehboweb.blob.core.windows.net/default-media/media/LMS/16 Snijwonden.lms\",\r\n      \"displayTitle\": \"Test je kennis\",\r\n      \"type\": \"LMSRow\"\r\n    }\r\n  ],\r\n  \"contentType\": 1\r\n}";

        var data = "{\r\n  \"id\": \"4mdym94a2rzv0vsgfeydxxs1wq\",\r\n  \"title\": \"Tekenbeet\",\r\n  \"keywords\": \"\",\r\n  \"rows\": [\r\n    {\r\n      \"text\": \"Teken zijn heel kleine spinachtige parasieten die leven in bossen, graslanden, struiken en duinen. Een teek heeft bloed nodig om zich voort te planten. Hij kan niet springen of vliegen, maar ‘wacht’ op planten of gras tot er een dier of mens voorbijkomt. \\r\\n\\r\\nDe teek laat zich dan vallen en hecht zich met de monddelen vast aan de huid van zijn slachtoffer. Hij zuigt zich gedurende meerdere uren tot dagen vol met bloed; een kleine huidwonde is het gevolg.\\r\\n\\r\\nEen tekenbeet op zich is niet gevaarlijk, maar de teek kan wel een rol spelen bij het overbrengen van verschillende ziektes (FSME of de ziekte van Lyme). \\r\\n\\r\\nDaarom moet je een teek zo snel mogelijk (binnen de 24 uur) verwijderen.\\r\\n\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"steps\": [\r\n        {\r\n          \"rows\": [\r\n            {\r\n              \"assetPath\": \"https://testehboweb.blob.core.windows.net/default-media/media/12 Steken, beten en letsels uit de natuur/Help2021_11_Steken_en_beten_11_LR.jpg\",\r\n              \"type\": \"MediaRow\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"rows\": [\r\n            {\r\n              \"assetPath\": \"https://testehboweb.blob.core.windows.net/default-media/media/12 Steken, beten en letsels uit de natuur/Help2021_11_Steken_en_beten_12.jpg\",\r\n              \"type\": \"MediaRow\"\r\n            }\r\n          ]\r\n        }\r\n      ],\r\n      \"type\": \"WizardRow\"\r\n    }\r\n  ],\r\n  \"contentType\": 1\r\n}\r\n\r\n{\r\n  \"id\": \"427ybbv47pmjbxbkvsnshd184w\",\r\n  \"title\": \"Tekenbeet\",\r\n  \"keywords\": \"\",\r\n  \"rows\": [\r\n    {\r\n      \"text\": \"## STAP 4\\r\\nVerleen verdere eerste hulp:\\r\\n- Verwijder de teek zo snel mogelijk. \\r\\n- Let erop dat de teek geen kans heeft om speeksel in de huid achter te laten. \\r\\n- Daarom neem je de teek best vast bij de monddelen en niet bij het lichaam. Bij druk op het lichaam kan de teek besmet speeksel en/of maaginhoud in de huid spuiten\\r\\n \\r\\n# Hulpmiddelen\\r\\n- Gebruik bij voorkeur een speciale tekenverwijderaar. Er bestaan verschillende modellen. Het koevoetmodel geeft de beste resultaten. Gebruik de tekenverwijderaar zoals omschreven in de gebruiksaanwijzing.\\r\\n- Gebruik liever geen pincet, aangezien de kans dan groot is dat je de teek plat knijpt. Alleen indien je geen tekenverwijderaar ter beschikking hebt, kan je de teek voorzichtig met een pincet verwijderen.\",\r\n      \"type\": \"TextRow\"\r\n    }\r\n  ],\r\n  \"contentType\": 1\r\n}\r\n\r\n{\r\n  \"id\": \"4nf9gc422vdfv7s0qf0hx8hm57\",\r\n  \"title\": \"Tekenbeet\",\r\n  \"keywords\": \"\",\r\n  \"rows\": [\r\n    {\r\n      \"text\": \"# De teek verwijderen\\r\\n- Trek de teek recht uit de huid.\\r\\n- Verdoof de teek vóór je hem verwijdert niet met alcohol, ether of met een brandende sigaret.\\r\\n- Trek de teek geleidelijk, maar stevig uit de huid.\\r\\n- Probeer de teek in zijn geheel te verwijderen, maar het is niet erg als een stukje van de teek in de huid blijft vastzitten. De bacterie kan niet meer worden doorgegeven, maar wel een kleine huidinfectie veroorzaken.\\r\\n\\r\\n\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"steps\": [\r\n        {\r\n          \"rows\": [\r\n            {\r\n              \"assetPath\": \"https://testehboweb.blob.core.windows.net/default-media/media/12 Steken, beten en letsels uit de natuur/Help2021_11_Steken_en_beten_14.jpg\",\r\n              \"type\": \"MediaRow\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"rows\": [\r\n            {\r\n              \"assetPath\": \"https://testehboweb.blob.core.windows.net/default-media/media/12 Steken, beten en letsels uit de natuur/Help2021_11_Steken_en_beten_15.jpg\",\r\n              \"type\": \"MediaRow\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"rows\": [\r\n            {\r\n              \"assetPath\": \"https://testehboweb.blob.core.windows.net/default-media/media/12 Steken, beten en letsels uit de natuur/Help2021_11_Steken_en_beten_16.jpg\",\r\n              \"type\": \"MediaRow\"\r\n            }\r\n          ]\r\n        }\r\n      ],\r\n      \"type\": \"WizardRow\"\r\n    },\r\n    {\r\n      \"text\": \"# Nazorg\\r\\n- Reinig de wonde uitgebreid met water en ontsmet nadien zorgvuldig met een waterig, niet-verkleurend ontsmettingsmiddel.\\r\\n- Noteer de datum van de beet en de plaats van de wonde. Observeer de plaats van de beet en noteer eventuele veranderingen van de huid. Het is belangrijk dat je veranderingen snel opmerkt.\\r\\n- Trek je wegwerphandschoenen uit en was of ontsmet je handen.\",\r\n      \"type\": \"TextRow\"\r\n    }\r\n  ],\r\n  \"contentType\": 1\r\n}\r\n{\r\n  \"id\": \"4sdx8f78xkz8e3wxvcmez9w75w\",\r\n  \"title\": \"Tekenbeet\",\r\n  \"keywords\": \"\",\r\n  \"rows\": [\r\n    {\r\n      \"text\": \"# Dit doe je!\\r\\n## STAP 1\\r\\n\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"text\": \" Zorg voor veiligheid\",\r\n      \"id\": \"4wndps0z5zjr55ezsbphazr3mz\",\r\n      \"openInInfoFlyout\": false,\r\n      \"type\": \"ThemeRow\"\r\n    },\r\n    {\r\n      \"text\": \"Was of ontsmet je handen en trek wegwerphandschoenen aan.\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"text\": \"## STAP 2\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"text\": \" Beoordeel de toestand van het slachtoffer\",\r\n      \"id\": \"4y1vwsmgnc1f7y4cygfzb8gvd7\",\r\n      \"openInInfoFlyout\": false,\r\n      \"type\": \"ThemeRow\"\r\n    },\r\n    {\r\n      \"text\": \"Ga na wat er mis is.\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"text\": \"## STAP 3\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"text\": \"Je hoeft niet voor elke tekenbeet naar de arts. Als je de teek op een correcte manier hebt verwijderd en verder geen symptomen hebt, is er geen probleem.\\r\\n\\r\\nRaadpleeg gespecialiseerde hulp als:\\r\\n- er in de eerste weken na de beet een rode kring verschijnt. Die jeukt meestal niet, is niet pijnlijk, schilfert niet en is meestal niet gezwollen. Een dergelijke kring kan wijzen op de ziekte van Lyme en treedt op bij besmetting met de ziekte in 8 op de 10 gevallen. Hij groeit langzaam verder gedurende meerdere weken;\\r\\n- iemand in een gebied verbleef waar FSME voorkomt en daarvoor niet werd gevaccineerd;\\r\\n- bij andere ziektetekenen zoals koorts, onverklaarbare vermoeidheid of gewrichtspijn.\",\r\n      \"type\": \"TextRow\"\r\n    },\r\n    {\r\n      \"text\": \" Raadpleeg gespecialiseerde hulp\",\r\n      \"id\": \"40jt3rtf6d8343abnemmp1jm52\",\r\n      \"openInInfoFlyout\": false,\r\n      \"type\": \"ThemeRow\"\r\n    }\r\n  ],\r\n  \"contentType\": 1\r\n}";

        var chatResult = await _openAiClient.GetChatCompletionsAsync("gpt-35-turbo",
                                                                     new ChatCompletionsOptions
                                                                     {
                                                                         Temperature = 0,
                                                                         MaxTokens = 2000,
                                                                         Messages =
                                                                         {
                                                                             doctorPrompt.System,
                                                                             doctorPrompt.Question(request.Question, data),
                                                                         }
                                                                     });
        var answer = chatResult.Value.Choices[0].Message.Content;
        var result = JsonSerializer.Deserialize<QuestionResponse>(answer);
        return result;
    }

    /*
     * I question the use of orchestrations here.
     * I don't feel it's good design to create a azure function for all the trivial function calls.
     * What I expect a question function will do is:
     *  Create a vector of the question.
     *  Find if this has been asked before:
     *      Yes: return the answer
     *      No: 1. Query the documents for hints.
     *          2. Construct Prompt
     *          3. Ask OpenAI for answer
     *          4. Store the answer
     *          5. Return the answer.
     */
    public record QuestionResponse(string Answer,
                                   QuestionResponseSource[] Sources);

   // public record QuestionResponseSource(ChunkId ChunkId, int ImportanceRating);
    public record QuestionResponseSource(string SourceId);
}